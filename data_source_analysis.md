# 数据来源分析报告

## 总体架构

该看板分为5个主要标签页：
1. 工厂业务概览
2. 品类战略分析
3. 供应商管理矩阵
4. 风险预警与建议
5. 数据明细总览

## 数据加载机制

所有数据通过 `load_data()` 函数从三个CSV文件加载：

### 1. 苏州、天津工厂数据总览.csv
主要字段：
- Business Unit: 业务单元名称
- 2024年入库金额: 实际入库金额
- 2025年预测采购额: 预测采购金额
- 增长金额: 同比增长金额
- 增长率: 同比增长率

### 2. 供应商2024-2025采购数据汇总.csv
主要字段：
- 供应商: 供应商名称
- Category: 品类
- Sub Category: 子品类
- 2024汇风入库金额: 汇风工厂实际入库金额
- 2024铜盟入库金额: 铜盟工厂实际入库金额
- 2024苏州入库金额: 苏州工厂实际入库金额
- 2024合计入库金额: 总实际入库金额
- 2025汇风预算金额: 汇风工厂预算金额
- 2025铜盟预算金额: 铜盟工厂预算金额
- 2025苏州预算金额: 苏州工厂预算金额
- 2025合计预算金额: 总预算金额
- 增长金额: 同比增长金额
- 增长率: 同比增长率

### 3. 各Subcategory-Spend汇总.csv
主要字段：
- Category: 品类
- Sub category: 子品类
- 2024年Spend: 实际采购支出
- 2025年Spend: 预测采购支出
- 增长金额: 同比增长金额
- 增长率: 同比增长率

数据加载设置了60秒的缓存时间（`@st.cache_data(ttl=60)`），确保数据每分钟至少更新一次。

### 各模块数据字段对应关系

#### 工厂业务概览
- 工厂采购规模对比图：使用 factory_data 的 Business Unit, 2024年入库金额, 2025年预测采购额
- 增长率分析图：使用 factory_data 的 Business Unit, 增长率
- 战略洞察指标：
  - 供应商占比：基于 supplier_data 的 2024合计入库金额 计算
  - 工厂数据：来自 factory_data 的各个金额字段

#### 品类战略分析
- 品类战略矩阵：使用 category_data 的 Category, 2024年Spend, 2025年Spend, 增长率
- Top 10分析：使用 category_data 的 Sub category, 增长率, 2024年Spend

#### 供应商管理矩阵
- 供应商矩阵图：使用 supplier_data 的 2024合计入库金额, 增长率, 2025合计预算金额, Category
- 供应商集中度：基于 supplier_data 的 2024合计入库金额 计算占比

#### 风险预警与建议
- 风险指标：使用 supplier_data 的采购金额和增长率
- 风险详情：使用 supplier_data 的各个金额字段和增长率

#### 数据明细总览
- Category汇总：使用 category_data 的所有字段
- 供应商明细：使用 supplier_data 的所有字段，包括各工厂的具体金额

## 各模块数据来源分析

### 1. 工厂业务概览

#### 1.1 工厂采购规模对比图
- **数据来源**: factory_data（实时）
- **计算逻辑**: 直接使用原始数据，无硬编码
- **更新机制**: 随数据刷新自动更新
- **状态**: ✅ 完全基于实时数据

#### 1.2 增长率分析图
- **数据来源**: factory_data（实时）
- **计算逻辑**: 直接使用原始数据的增长率字段
- **更新机制**: 随数据刷新自动更新
- **状态**: ✅ 完全基于实时数据

#### 1.3 战略洞察文本
- **数据来源**: 部分实时，部分硬编码
- **实时数据部分**: 
  - Top10供应商占比
  - Top5供应商占比
  - 高依赖供应商数量
- **硬编码部分**: 
  - 具体金额描述（如"天津铜盟2024年入库4.61亿"）
  - 品类占比描述（如"铜材类采购占总采购额的42%"）
- **状态**: ⚠️ 需要优化，将硬编码部分改为实时计算

### 2. 品类战略分析

#### 2.1 品类战略矩阵分析图
- **数据来源**: category_data（实时）
- **计算逻辑**: 实时计算汇总数据
- **更新机制**: 随数据刷新自动更新
- **状态**: ✅ 完全基于实时数据

#### 2.2 Top 10高增长和负增长子品类
- **数据来源**: category_data（实时）
- **计算逻辑**: 实时筛选和排序
- **更新机制**: 随数据刷新自动更新
- **状态**: ✅ 完全基于实时数据

#### 2.3 品类战略建议
- **数据来源**: 完全硬编码
- **更新机制**: 无自动更新
- **状态**: ❌ 需要改进，建议基于实时数据生成建议

#### 2.4 品类趋势矩阵
- **数据来源**: category_data（实时）
- **计算逻辑**: 实时计算各项指标
- **更新机制**: 随数据刷新自动更新
- **状态**: ✅ 完全基于实时数据

### 3. 供应商管理矩阵

#### 3.1 供应商战略矩阵图
- **数据来源**: supplier_data（实时）
- **计算逻辑**: 实时筛选Top 50供应商
- **更新机制**: 随数据刷新自动更新
- **状态**: ✅ 完全基于实时数据

#### 3.2 供应商集中度分析
- **数据来源**: supplier_data（实时）
- **计算逻辑**: 实时计算各项指标
- **更新机制**: 随数据刷新自动更新
- **状态**: ✅ 完全基于实时数据

#### 3.3 供应商战略建议
- **数据来源**: 完全硬编码
- **更新机制**: 无自动更新
- **状态**: ❌ 需要改进，建议基于实时数据生成建议

### 4. 风险预警与建议

#### 4.1 主要风险指标
- **数据来源**: 混合（实时数据+硬编码阈值）
- **实时部分**: 各项指标的具体数值
- **硬编码部分**: 风险阈值（如"需要关注"的判断标准）
- **状态**: ⚠️ 建议将风险阈值参数化

#### 4.2 风险地图
- **数据来源**: 完全硬编码
- **更新机制**: 无自动更新
- **状态**: ❌ 需要改进，建议基于实时数据评估风险等级

#### 4.3 风险详情分析
- **数据来源**: supplier_data（实时）
- **计算逻辑**: 实时计算风险指标
- **更新机制**: 随数据刷新自动更新
- **状态**: ✅ 完全基于实时数据

#### 4.4 风险跟踪记录
- **数据来源**: 完全硬编码
- **更新机制**: 无自动更新
- **状态**: ❌ 需要改进，建议添加风险跟踪数据源

### 5. 数据明细总览

#### 5.1 Category级别汇总
- **数据来源**: category_data（实时）
- **计算逻辑**: 实时汇总计算
- **更新机制**: 随数据刷新自动更新
- **状态**: ✅ 完全基于实时数据

#### 5.2 Sub Category明细
- **数据来源**: category_data（实时）
- **计算逻辑**: 实时筛选和计算
- **更新机制**: 随数据刷新自动更新
- **状态**: ✅ 完全基于实时数据

#### 5.3 供应商明细
- **数据来源**: supplier_data（实时）
- **计算逻辑**: 实时筛选和计算
- **更新机制**: 随数据刷新自动更新
- **状态**: ✅ 完全基于实时数据

## 改进建议

### 1. 需要立即改进的部分
1. 工厂业务概览中的战略洞察文本应改为动态生成
2. 品类战略建议应基于实时数据分析生成
3. 风险预警的阈值应参数化，便于调整
4. 风险跟踪记录需要添加数据源

### 2. 建议添加的功能
1. 风险阈值的配置界面
2. 历史数据趋势分析
3. 自动生成的战略建议
4. 风险跟踪数据库

### 3. 数据更新机制优化
1. 添加数据版本控制
2. 增加数据质量检查
3. 添加数据更新日志
4. 实现数据异常预警

## 总结

- 完全基于实时数据的模块: 60%
- 部分依赖硬编码的模块: 25%
- 完全硬编码的模块: 15%

主要数据可视化图表都是基于实时数据生成，但分析建议和风险评估部分还存在较多硬编码内容，需要进一步优化。建议优先改进风险预警系统和战略建议生成机制，使其能够基于实时数据动态生成。 